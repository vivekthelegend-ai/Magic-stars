<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Hand Repulsion Particles</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; }
    video { display: none; }
  </style>
</head>
<body>

<video id="video" autoplay></video>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
let scene, camera, renderer;
let particles, positions;
const COUNT = 50000;
const repelRadius = 0.3;

init();
animate();
initCamera();

function init() {
  scene = new THREE.Scene();

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.z = 5;

  renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  const geometry = new THREE.BufferGeometry();
  positions = new Float32Array(COUNT * 3);

  for (let i = 0; i < COUNT * 3; i++) {
    positions[i] = (Math.random() - 0.5) * 10;
  }

  geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

  const material = new THREE.PointsMaterial({
    size: 0.03,
    color: 0x00ffff
  });

  particles = new THREE.Points(geometry, material);
  scene.add(particles);
}

function animate() {
  requestAnimationFrame(animate);
  particles.rotation.y += 0.0005;
  renderer.render(scene, camera);
}

// ---------------- HAND TRACKING ----------------

function initCamera() {
  const video = document.getElementById("video");

  const hands = new Hands({
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
  });

  hands.setOptions({
    maxNumHands: 1,
    minDetectionConfidence: 0.7,
    minTrackingConfidence: 0.7
  });

  hands.onResults(onResults);

  const cameraMP = new Camera(video, {
    onFrame: async () => {
      await hands.send({ image: video });
    },
    width: 640,
    height: 480
  });

  cameraMP.start();
}

function onResults(results) {
  if (!results.multiHandLandmarks) return;

  const hand = results.multiHandLandmarks[0][9];
  const hx = (hand.x - 0.5) * 5;
  const hy = -(hand.y - 0.5) * 5;

  const arr = particles.geometry.attributes.position.array;

  for (let i = 0; i < COUNT; i++) {
    const ix = i * 3;
    const dx = arr[ix] - hx;
    const dy = arr[ix + 1] - hy;
    const dist = Math.sqrt(dx*dx + dy*dy);

    if (dist < repelRadius) {
      arr[ix] += dx * 0.05;
      arr[ix + 1] += dy * 0.05;
    }
  }

  particles.geometry.attributes.position.needsUpdate = true;
}
</script>

</body>
</html>
